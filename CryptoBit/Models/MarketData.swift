//
//  MarketData.swift
//  CryptoBit
//
//  Created by Данила Рахманов on 30.09.2024.
//

import Foundation

/*
 
 URL: https://api.coingecko.com/api/v3/global
 
 JSON Response:
 {
   "data": {
     "active_cryptocurrencies": 14684,
     "upcoming_icos": 0,
     "ongoing_icos": 49,
     "ended_icos": 3376,
     "markets": 1202,
     "total_market_cap": {
       "btc": 36944394.88303903,
       "eth": 898301829.4859773,
       "ltc": 35121984495.47542,
       "bch": 6852036478.760142,
       "bnb": 4097733861.2008653,
       "eos": 4391950087741.0796,
       "xrp": 3750633999753.5234,
       "xlm": 23183527620699.08,
       "link": 194550154628.6116,
       "dot": 511010470542.29285,
       "yfi": 430025989.5790965,
       "usd": 2366112301549.928,
       "aed": 8690730483592.871,
       "ars": 2295100539155810.5,
       "aud": 3412686362546.89,
       "bdt": 282635779528094.0,
       "bhd": 891790092566.4688,
       "bmd": 2366112301549.928,
       "brl": 12883954704399.68,
       "cad": 3192204919951.563,
       "chf": 1995337771672.4512,
       "clp": 2119445094113348.8,
       "cny": 16592599125849.027,
       "czk": 53317929646992.52,
       "dkk": 15782262449263.414,
       "eur": 2116733529415.7712,
       "gbp": 1767123874075.659,
       "gel": 6435825460215.797,
       "hkd": 18374388163969.684,
       "huf": 840402460996206.1,
       "idr": 3.5887184214477788e+16,
       "ils": 8782961541107.314,
       "inr": 198287427512403.72,
       "jpy": 338018071174819.4,
       "krw": 3107931221145098.5,
       "kwd": 722026267154.864,
       "lkr": 700820461240795.6,
       "mmk": 4.964103608651766e+15,
       "mxn": 46281956364274.55,
       "myr": 9756664075441.107,
       "ngn": 3.948662853318569e+15,
       "nok": 24878168369486.004,
       "nzd": 3720008858833.716,
       "php": 132609954094853.48,
       "pkr": 656932641412170.0,
       "pln": 9056110277422.844,
       "rub": 220044461877139.88,
       "sar": 8876269179718.91,
       "sek": 23929837657361.68,
       "sgd": 3031900811521.5547,
       "thb": 76402949273197.97,
       "try": 80866854375189.66,
       "twd": 75011675239886.64,
       "uah": 97511739850678.52,
       "vef": 236918824754.19418,
       "vnd": 5.812830420891881e+16,
       "zar": 40725877485010.34,
       "xdr": 1745762612217.2659,
       "xag": 75691364659.62976,
       "xau": 895833778.4898163,
       "bits": 36944394883039.03,
       "sats": 3694439488303902.5
     },
     "total_volume": {
       "btc": 1440238.879981812,
       "eth": 35019364.23320494,
       "ltc": 1369194102.9930077,
       "bch": 267119528.55112627,
       "bnb": 159745900.43776643,
       "eos": 171215614583.20752,
       "xrp": 146214572687.63278,
       "xlm": 903785755868.2638,
       "link": 7584335802.214956,
       "dot": 19921212678.751812,
       "yfi": 16764116.763996696,
       "usd": 92240431650.97131,
       "aed": 338799105454.0171,
       "ars": 89472111816262.33,
       "aud": 133040034897.96568,
       "bdt": 11018262441137.152,
       "bhd": 34765510929.68272,
       "bmd": 92240431650.97131,
       "brl": 502267598425.86945,
       "cad": 124444794755.43321,
       "chf": 77786171530.4008,
       "clp": 82624366651357.58,
       "cny": 646845250995.6016,
       "czk": 2078544134254.7932,
       "dkk": 615255116925.5035,
       "eur": 82518659116.68552,
       "gbp": 68889489657.23297,
       "gel": 250893974090.6417,
       "hkd": 716306446848.2069,
       "huf": 32762217461973.2,
       "idr": 1.399024619631523e+15,
       "ils": 342394637479.773,
       "inr": 7730029505667.934,
       "jpy": 13177283584794.451,
       "krw": 121159472097823.0,
       "kwd": 28147444439.588806,
       "lkr": 27320758111243.746,
       "mmk": 193520425603738.47,
       "mxn": 1804254020358.8982,
       "myr": 380353419912.7794,
       "ngn": 153934521956406.47,
       "nok": 969849566135.8649,
       "nzd": 145020683362.95264,
       "php": 5169661388815.812,
       "pkr": 25609837018208.27,
       "pln": 353043057390.4245,
       "rub": 8578204902893.867,
       "sar": 346032138901.92804,
       "sek": 932879877851.4498,
       "sgd": 118195505511.07988,
       "thb": 2978489658225.69,
       "try": 3152510364337.9766,
       "twd": 2924252284414.92,
       "uah": 3801393944392.209,
       "vef": 9236034421.211754,
       "vnd": 2266071592568702.5,
       "zar": 1587656053400.8362,
       "xdr": 68056743040.28799,
       "xag": 2950749270.810974,
       "xau": 34923149.827374175,
       "bits": 1440238879981.812,
       "sats": 144023887998181.22
     },
     "market_cap_percentage": {
       "btc": 53.488254612263596,
       "eth": 13.401899314035795,
       "usdt": 5.052233792514827,
       "bnb": 3.5603124259025716,
       "sol": 3.1111152965057833,
       "usdc": 1.5199260691472838,
       "xrp": 1.5096038422521725,
       "steth": 1.0921108055714364,
       "doge": 0.7459109502256129,
       "ton": 0.6240760929942903
     },
     "market_cap_change_percentage_24h_usd": -2.697973926076246,
     "updated_at": 1727702860
   }
 }
 
 */

struct GlobalData: Codable {
    let data: MarketData?
}

struct MarketData: Codable {
    let totalMarketCap, totalVolume, marketCapPercentage: [String: Double]
    let marketCapChangePercentage24HUsd: Double

    enum CodingKeys: String, CodingKey {
        case totalMarketCap = "total_market_cap"
        case totalVolume = "total_volume"
        case marketCapPercentage = "market_cap_percentage"
        case marketCapChangePercentage24HUsd = "market_cap_change_percentage_24h_usd"
    }
    
    var marketCap: String {
        if let item = totalMarketCap.first(where: { $0.key == "usd"}) {
            return "$\(item.value.formattedWithAbbreviations())"
        }
        return String()
    }
    
    var volume: String {
        if let item = totalVolume.first(where: { $0.key == "usd"}) {
            return "$\(item.value.formattedWithAbbreviations())"
        }
        return String()
    }
    
    var btcDominance: String {
        if let item = marketCapPercentage.first(where: { $0.key == "btc"}) {
            return String(item.value.asPercentString())
        }
        return String()
    }
}
